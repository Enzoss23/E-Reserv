<div class="overlay">
  <div class="dialog" role="dialog" aria-modal="true" [attr.aria-label]="isView ? ('Reserva #' + (data?.id || '')) : (data ? 'Editar Reserva' : 'Nova Reserva')">
    <div class="dialog-header">
      <div class="dialog-title">{{ isView ? ('Reserva #' + (data?.id || '')) : (data ? 'Editar Reserva' : 'Nova Reserva') }}</div>
      <button class="close" type="button" aria-label="Fechar" (click)="onCancel()">&times;</button>
    </div>

    <div *ngIf="isView" class="view">
      <div class="v-banner" [class.pending]="(data?.status||'').toLowerCase().includes('pend')" [class.confirmed]="(data?.status||'').toLowerCase().includes('confirm')" [class.cancelled]="(data?.status||'').toLowerCase().includes('cancel')">
        <mat-icon>info</mat-icon>
        <div>
          <div class="v-banner-title">{{ data?.status === 'Pendente' ? 'Reserva Pendente de Confirmação' : 'Status da Reserva' }}</div>
          <div *ngIf="data?.status === 'Pendente'">Esta reserva foi criada pelo cliente e aguarda confirmação do restaurante.</div>
          <div *ngIf="data?.status === 'Confirmada'">Esta reserva foi confirmada.</div>
          <div *ngIf="data?.status === 'Cancelada'">Esta reserva foi cancelada.</div>
        </div>
      </div>

      <div class="v-card">
        <div class="v-card-title"><mat-icon>info</mat-icon>Informações da reserva</div>
        <div class="v-info-grid">
          <div class="v-kv"><span>Status</span><b class="tag" [class.orange]="(data?.status||'').toLowerCase().includes('pend')" [class.green]="(data?.status||'').toLowerCase().includes('confirm')" [class.red]="(data?.status||'').toLowerCase().includes('cancel')">{{ data?.status }}</b></div>
          <div class="v-kv"><span>ID da Reserva</span><b>#{{ data?.id }}</b></div>
          <div class="v-kv"><span>Data da Reserva</span><b>{{ data?.date }}</b></div>
          <div class="v-kv"><span>Horário</span><b>{{ data?.time }}</b></div>
          <div class="v-kv"><span>Quantidade de Pessoas</span><b>{{ data?.people }} {{ data?.people === 1 ? 'pessoa' : 'pessoas' }}</b></div>
          <div class="v-kv"><span>Ambiente</span><b>{{ data?.area }}</b></div>
          <div class="v-kv"><span>Mesa Atribuída</span><b>{{ data?.assignedTable }}</b></div>
          <div class="v-kv"><span>Origem</span><b>{{ data?.origin || 'Site' }}</b></div>
        </div>
      </div>

      <div class="v-card">
        <div class="v-card-title"><mat-icon>person</mat-icon>Informações do Cliente</div>
        <div class="v-info-grid two">
          <div class="v-kv"><span>Nome Completo</span><b>{{ data?.name }}</b></div>
          <div class="v-kv"><span>Telefone</span><b>{{ data?.phone || '-' }}</b></div>
          <div class="v-kv full"><span>E-mail</span><b>{{ data?.email || '-' }}</b></div>
        </div>
      </div>

      <div class="v-card">
        <div class="v-card-title"><mat-icon>edit</mat-icon>Observações</div>
        <div class="v-notes">{{ data?.notes || '—' }}</div>
      </div>

      <div class="dialog-actions center">
        <button mat-raised-button color="primary" type="button" (click)="onCancel()">Fechar</button>
      </div>
    </div>

    <!-- Create/Edit Mode -->
    <form *ngIf="!isView" (ngSubmit)="onConfirm()" class="form">
      <div class="grid two">

        <!-- Status -->
        <div class="fld">
          <div class="fld-label">Status</div>
          <mat-form-field appearance="fill">
            <mat-select toggleOnClick name="status" [(ngModel)]="form.status">
              <mat-option *ngFor="let s of statuses" [value]="s">{{ s }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Mesa atribuída -->
        <div class="fld">
          <div class="fld-label">Mesa Atribuída</div>
          <mat-form-field appearance="fill">
            <mat-select toggleOnClick name="assignedTable" [(ngModel)]="form.assignedTable">
              <mat-option *ngFor="let m of mesas" [value]="m">{{ m }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Data -->
        <div class="fld">
          <div class="fld-label">Data da Reserva</div>
          <mat-form-field appearance="fill">
            <input matInput type="date" name="date" [(ngModel)]="form.date" required />
            <mat-icon matSuffix>calendar_today</mat-icon>
          </mat-form-field>
        </div>

        <!-- Horário -->
        <div class="fld">
          <div class="fld-label">Horário</div>
          <mat-form-field appearance="fill">
            <input matInput type="time" name="time" [(ngModel)]="form.time" required />
            <mat-icon matSuffix>schedule</mat-icon>
          </mat-form-field>
        </div>

        <!-- Quantidade de Pessoas -->
        <div class="fld">
          <div class="fld-label">Quantidade de Pessoas</div>
          <mat-form-field appearance="fill">
            <mat-select toggleOnClick name="people" [(ngModel)]="form.people">
              <mat-option *ngFor="let p of peopleOptions" [value]="p">
                {{ p }} {{ p === 1 ? 'pessoa' : 'pessoas' }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Ambiente -->
        <div class="fld">
          <div class="fld-label">Ambiente</div>
          <mat-form-field appearance="fill">
            <mat-select toggleOnClick name="area" [(ngModel)]="form.area">
              <mat-option *ngFor="let a of ambientes" [value]="a">{{ a }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div class="divider"></div>

      <!-- Seção Cliente -->
      <div class="section-line">
        <mat-icon class="section-ic" inline>person</mat-icon>
        <span>Informações do Cliente</span>
      </div>

      <div class="grid two">
        <div class="fld">
          <div class="fld-label">Nome Completo</div>
          <mat-form-field appearance="fill">
            <input matInput name="name" [(ngModel)]="form.name" required />
          </mat-form-field>
        </div>

        <div class="fld">
          <div class="fld-label">Telefone</div>
          <mat-form-field appearance="fill">
            <input matInput name="phone" [(ngModel)]="form.phone" />
          </mat-form-field>
        </div>

        <div class="fld full">
          <div class="fld-label">E-mail</div>
          <mat-form-field appearance="fill">
            <input matInput type="email" name="email" [(ngModel)]="form.email" />
          </mat-form-field>
        </div>

        
      </div>

      <div class="divider"></div>

      <div class="section-line">
        <mat-icon class="section-ic" inline>edit</mat-icon>
        <span>Observações</span>
      </div>

      <mat-form-field appearance="fill" class="full">
        <textarea
          matInput rows="4" name="notes" [(ngModel)]="form.notes"
          placeholder="Cliente solicitou cadeirante para uma pessoa do grupo. Preferência por mesa próxima à janela">
        </textarea>
      </mat-form-field>

      <div class="dialog-actions center">
        <button mat-raised-button color="primary" type="submit">Confirmar</button>
        <button mat-raised-button color="warn" type="button" (click)="onCancel()">Cancelar</button>
      </div>
    </form>
  </div>
</div>
