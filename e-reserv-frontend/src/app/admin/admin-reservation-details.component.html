<div class="page">
  <div class="breadcrumbs">
    <span class="crumb" (click)="back()">/ Reservas</span>
    <span class="sep">/</span>
    <span class="crumb">Detalhes da Reserva</span>
    <span class="sep">/</span>
    <span class="crumb strong">#{{ reservation?.id }}</span>
  </div>

  <div class="header-row">
    <h1 class="title">Reserva #{{ reservation?.id }}</h1>
    <div class="actions">
      <ng-container *ngIf="!isEditing; else editingBtns">
        <button mat-stroked-button color="primary" (click)="startInlineEdit()">Editar Reserva</button>
        <button mat-raised-button color="warn">Excluir reserva</button>
      </ng-container>
      <ng-template #editingBtns>
        <button mat-raised-button color="primary" (click)="saveInlineEdit()">Salvar</button>
        <button mat-stroked-button (click)="cancelInlineEdit()">Cancelar</button>
      </ng-template>
    </div>
  </div>

  <div class="status-banner" [class.pending]="statusClass.pending" [class.confirmed]="statusClass.confirmed" [class.cancelled]="statusClass.cancelled">
    <mat-icon>info</mat-icon>
    <div>
      <div class="b-title">{{ reservation?.status === 'Pendente' ? 'Reserva Pendente de Confirmação' : 'Status da Reserva' }}</div>
      <div *ngIf="reservation?.status === 'Pendente'">Esta reserva foi criada pelo cliente e aguarda confirmação do restaurante.</div>
      <div *ngIf="reservation?.status === 'Confirmada'">Esta reserva foi confirmada.</div>
      <div *ngIf="reservation?.status === 'Cancelada'">Esta reserva foi cancelada.</div>
    </div>
  </div>

  <div class="grid">
    <div class="left">
      <div class="card">
        <div class="card-title"><mat-icon>info</mat-icon>Informações da reserva</div>
        <div class="info-grid">
          <div class="kv">
            <span>Status</span>
            <ng-container *ngIf="!isEditing; else stEdit">
              <b class="tag" [class.orange]="statusClass.pending" [class.green]="statusClass.confirmed" [class.red]="statusClass.cancelled">{{ reservation?.status }}</b>
            </ng-container>
            <ng-template #stEdit>
              <select [(ngModel)]="draft.status">
                <option>Pendente</option>
                <option>Confirmada</option>
                <option>Cancelada</option>
              </select>
            </ng-template>
          </div>
          <div class="kv"><span>ID da Reserva</span><b>#{{ reservation?.id }}</b></div>
          <div class="kv">
            <span>Data da Reserva</span>
            <ng-container *ngIf="!isEditing; else dateEdit"><b>{{ reservation?.date }}</b></ng-container>
            <ng-template #dateEdit><input type="date" [(ngModel)]="draft.date"></ng-template>
          </div>
          <div class="kv">
            <span>Horário</span>
            <ng-container *ngIf="!isEditing; else timeEdit"><b>{{ reservation?.time }}</b></ng-container>
            <ng-template #timeEdit><input type="time" [(ngModel)]="draft.time"></ng-template>
          </div>
          <div class="kv">
            <span>Quantidade de Pessoas</span>
            <ng-container *ngIf="!isEditing; else pplEdit"><b>{{ reservation?.people }} {{ reservation?.people === 1 ? 'pessoa' : 'pessoas' }}</b></ng-container>
            <ng-template #pplEdit><input type="number" min="1" [(ngModel)]="draft.people"></ng-template>
          </div>
          <div class="kv">
            <span>Ambiente</span>
            <ng-container *ngIf="!isEditing; else areaEdit"><b>{{ reservation?.area }}</b></ng-container>
            <ng-template #areaEdit><input [(ngModel)]="draft.area"></ng-template>
          </div>
          <div class="kv">
            <span>Mesa Atribuída</span>
            <ng-container *ngIf="!isEditing; else mesaEdit"><b>{{ reservation?.assignedTable }}</b></ng-container>
            <ng-template #mesaEdit><input [(ngModel)]="draft.assignedTable"></ng-template>
          </div>
          <div class="kv">
            <span>Origem</span>
            <ng-container *ngIf="!isEditing; else origEdit"><b>{{ reservation?.origin || 'Site' }}</b></ng-container>
            <ng-template #origEdit><input [(ngModel)]="draft.origin"></ng-template>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title"><mat-icon>person</mat-icon>Informações do Cliente</div>
        <div class="info-grid">
          <div class="kv">
            <span>Nome Completo</span>
            <ng-container *ngIf="!isEditing; else nameEdit"><b>{{ reservation?.name }}</b></ng-container>
            <ng-template #nameEdit><input [(ngModel)]="draft.name"></ng-template>
          </div>
          <div class="kv">
            <span>Telefone</span>
            <ng-container *ngIf="!isEditing; else phoneEdit"><b>{{ reservation?.phone || '-' }}</b></ng-container>
            <ng-template #phoneEdit><input [(ngModel)]="draft.phone"></ng-template>
          </div>
          <div class="kv">
            <span>E-mail</span>
            <ng-container *ngIf="!isEditing; else emailEdit"><b>{{ reservation?.email || '-' }}</b></ng-container>
            <ng-template #emailEdit><input [(ngModel)]="draft.email"></ng-template>
          </div>
          <div class="kv">
            <span>CPF</span>
            <ng-container *ngIf="!isEditing; else cpfEdit"><b>{{ reservation?.cpf || '-' }}</b></ng-container>
            <ng-template #cpfEdit><input [(ngModel)]="draft.cpf"></ng-template>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title"><mat-icon>edit</mat-icon>Observações</div>
        <div class="notes" *ngIf="!isEditing">{{ reservation?.notes || '—' }}</div>
        <textarea class="notes" *ngIf="isEditing" [(ngModel)]="draft.notes"></textarea>
      </div>
    </div>

    <div class="right">
      <div class="card side">
        <div class="side-title"><mat-icon>bolt</mat-icon>Ações Rápidas</div>
        <button mat-stroked-button color="primary" class="side-btn" (click)="confirm()"><mat-icon>task_alt</mat-icon>Confirmar reserva</button>
        <button mat-stroked-button class="side-btn" (click)="cancel()"><mat-icon>close</mat-icon>Cancelar reserva</button>
        <button mat-stroked-button class="side-btn"><mat-icon>sms</mat-icon>Enviar SMS</button>
        <button mat-stroked-button class="side-btn"><mat-icon>mail</mat-icon>Enviar E-mail</button>
        <button mat-stroked-button class="side-btn"><mat-icon>print</mat-icon>Imprimir comprovante</button>
      </div>

      <div class="card side">
        <div class="side-title"><mat-icon>history</mat-icon>Histórico</div>
        <div class="history-item">
          <mat-icon>event</mat-icon>
          <div>
            <div class="h-date">{{ reservation?.date }} às {{ reservation?.time }}</div>
            <div><b>Sistema</b> criou a reserva via Site</div>
          </div>
        </div>
        <div class="history-item">
          <mat-icon>mail</mat-icon>
          <div>
            <div class="h-date">{{ reservation?.date }} às {{ reservation?.time }}</div>
            <div>E-mail de confirmação enviado para <b>{{ reservation?.email }}</b></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-admin-new-reservation-dialog
  *ngIf="isEditOpen"
  [mode]="'edit'"
  [data]="reservation"
  (close)="closeEdit()"
  (confirm)="onEditConfirm($event)"></app-admin-new-reservation-dialog>
